<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>RespVis - Playground</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <style>
      .chart-container {
        width: 100%;
        height: 50vh;
        min-height: 25rem;
      }

      .layout {
        box-shadow: inset 0px 0px 0px 1px #000;
      }

      body {
        background-color: floralwhite;
      }
    </style>
  </head>
  <body>
    <h1>Bar Chart</h1>

    <div id="root" class="chart-container"></div>
    <script src="./vendor/d3.v6.js"></script>
    <script src="../respvis.js"></script>
    <script type="module">
      const root = d3.select('#root'),
        layouter = root.append('div').call(respVis.layouter),
        chart = layouter
          .append('svg')
          .layout('display', 'grid')
          .layout('grid-template', '1fr 10rem / 0.25fr 1fr')
          .layout('padding', '1rem')
          .call(respVis.chart),
        leftAxis = chart
          .append('svg')
          .layout('grid-area', '1 / 1 / 2 / 2')
          .layout('display', 'flex')
          .layout('justify-content', 'center')
          .layout('align-items', 'center'),
        leftAxisTitle = leftAxis
          .append('text')
          .text('Y Title')
          .layout('width', 'fit')
          .layout('height', 'fit')
          .attr('text-anchor', 'start')
          .attr('dominant-baseline', 'hanging'),
        bottomAxis = chart.append('svg').layout('grid-area', '2 / 2 / 3 / 3'),
        drawArea = chart.append('svg').layout('grid-area', '1 / 2 / 2 / 3');

      // const root = d3.select('#root'),
      //   layouter = root
      //     .append('div')
      //     .style('position', 'relative')
      //     .style('width', '100%')
      //     .style('height', '100%'),
      //   chart = layouter
      //     .append('svg')
      //     .layout('display', 'grid')
      //     .layout('grid-template', '1fr 10rem / 0.25fr 1fr')
      //     .layout('padding', '1rem'),
      //   leftAxis = chart
      //     .append('g')
      //     .layout('grid-area', '1 / 1 / 2 / 2')
      //     .layout('display', 'flex')
      //     .layout('position', 'relative')
      //     .layout('justify-content', 'center')
      //     .layout('align-items', 'center'),
      //   leftAxisTitle = leftAxis
      //     .append('text')
      //     .text('Y Title')
      //     .layout('width', 'fit')
      //     .layout('height', 'fit')
      //     .attr('text-anchor', 'start')
      //     .attr('dominant-baseline', 'hanging'),
      //   bottomAxis = chart.append('g').layout('grid-area', '2 / 2 / 3 / 3'),
      //   drawArea = chart.append('g').layout('grid-area', '1 / 2 / 2 / 3');

      // // const resizeObserver = new ResizeObserver((entries) => {

      // //   console.log('resize');
      // // });

      // function layout(selection) {
      //   const svg = selection
      //     .selectChildren(':not(.layout)')
      //     .layout('position', 'absolute')
      //     .layout('top', 0)
      //     .layout('bottom', 0)
      //     .layout('left', 0)
      //     .layout('right', 0);
      //   const layout = selection
      //     .selectChildren('div')
      //     .data(svg.nodes().map((n) => d3.select(n)))
      //     .join('div')
      //     .style('visibility', 'hidden');
      //   layoutInner(layout);
      //   // applyLayout(layout);
      // }

      // function layoutInner(selection) {
      //   if (selection.empty()) return;
      //   layoutInner(
      //     selection
      //       // .each((d, i, g) => {
      //       //   resizeObserver.observe(g[i]);
      //       // })
      //       .attr('style', (d) =>
      //         d
      //           .attr('layout')
      //           .replace(
      //             /(width|height): fit;/g,
      //             (_, captureGroup) =>
      //               `${captureGroup}: ${d.node().getBoundingClientRect()[captureGroup]}px;`
      //           )
      //       )
      //       .attr('class', (d) => d.attr('class'))
      //       .classed('layout', true)
      //       .selectChildren('div')
      //       .data((d) =>
      //         d
      //           .selectChildren('[layout]')
      //           .nodes()
      //           .map((n) => d3.select(n))
      //       )
      //       .join('div')
      //   );
      // }

      // function applyLayout(selection) {
      //   if (selection.empty()) return;
      //   applyLayout(
      //     selection
      //       .each((d, i, g) => {
      //         const layout = d3.select(g[i]);
      //         const layoutNode = layout.node();
      //         const svgNode = d.node();
      //         const bounds = relativeBounds(layoutNode);
      //         switch (svgNode.tagName) {
      //           case 'svg':
      //           case 'rect':
      //             d.attr('x', bounds.x)
      //               .attr('y', bounds.y)
      //               .attr('width', bounds.width)
      //               .attr('height', bounds.height);
      //             break;
      //           default:
      //             d.attr('transform', `translate(${bounds.x}, ${bounds.y})`);
      //         }
      //       })
      //       .selectChildren('div')
      //       .data((d) =>
      //         d
      //           .selectChildren('[layout]')
      //           .nodes()
      //           .map((n) => d3.select(n))
      //       )
      //       .join('div')
      //   );
      // }

      // layouter.call(layout);
    </script>
  </body>
</html>
